<html><head></head><body>
  <html lang="zh-TW">
  <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>第八節意願調查填報與查詢</title>
      <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
      <style>
          :root {
              --primary-color: #4a90e2;
              --secondary-color: #50d890;
              --background-color: #f7f9fc;
              --text-color: #333333;
              --card-background: #ffffff;
              --accent-color: #ff6b6b;
              --header-bg: #2c3e50;
              --box-shadow: 0 10px 20px rgba(0,0,0,0.1);
          }
  
          * {
              box-sizing: border-box;
              margin: 0;
              padding: 0;
          }
  
          body {
              font-family: 'Noto Sans TC', sans-serif;
              line-height: 1.6;
              color: var(--text-color);
              background-color: var(--background-color);
              min-height: 100vh;
              display: flex;
              flex-direction: column;
              transition: background-color 0.5s ease;
          }
  
          .header {
              background-color: var(--header-bg);
              color: #ffffff;
              padding: 1rem;
              position: sticky;
              top: 0;
              z-index: 1000;
              box-shadow: var(--box-shadow);
              transition: all 0.5s ease;
          }
  
          .header-content {
              max-width: 1200px;
              margin: 0 auto;
              display: flex;
              justify-content: space-between;
              align-items: center;
          }
  
          .header h1 {
              font-size: 1.8rem;
              font-weight: 700;
              letter-spacing: 1px;
              transition: transform 0.3s ease;
          }
  
          .header:hover h1 {
              transform: scale(1.05);
          }
  
          .container {
              max-width: 800px;
              width: 90%;
              margin: 3rem auto;
              padding: 2.5rem;
              background-color: var(--card-background);
              border-radius: 15px;
              box-shadow: var(--box-shadow);
              transition: all 0.5s ease;
              opacity: 0;
              transform: translateY(20px);
              animation: fadeInUp 0.8s ease forwards;
          }
  
          @keyframes fadeInUp {
              to {
                  opacity: 1;
                  transform: translateY(0);
              }
          }
  
          .container:hover {
              transform: translateY(-5px);
              box-shadow: 0 15px 30px rgba(0,0,0,0.15);
          }
  
          h1 {
              color: var(--primary-color);
              margin-bottom: 1.5rem;
              text-align: center;
              font-size: 2.2rem;
              font-weight: 700;
              transition: color 0.3s ease;
          }
  
          form {
              display: flex;
              flex-direction: column;
              gap: 1.2rem;
          }
  
          label {
              font-weight: 500;
              color: var(--text-color);
              font-size: 1.1rem;
              transition: color 0.3s ease;
          }
  
          input[type="text"] {
              width: 100%;
              padding: 0.9rem;
              border: 2px solid #e0e0e0;
              border-radius: 8px;
              font-size: 1rem;
              transition: all 0.3s ease;
          }
  
          input[type="text"]:focus {
              outline: none;
              border-color: var(--primary-color);
              box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.2);
          }
  
          button {
              background-color: var(--secondary-color);
              color: white;
              padding: 0.9rem;
              border: none;
              border-radius: 8px;
              cursor: pointer;
              font-size: 1.1rem;
              font-weight: 500;
              transition: all 0.3s ease;
              box-shadow: 0 2px 5px rgba(0,0,0,0.1);
          }
  
          button:hover {
              background-color: #45c17c;
              transform: translateY(-2px);
              box-shadow: 0 4px 8px rgba(0,0,0,0.2);
          }
  
          #result {
              margin-top: 2rem;
              background-color: var(--card-background);
              padding: 1.8rem;
              border-radius: 12px;
              box-shadow: var(--box-shadow);
              transition: all 0.5s ease;
              opacity: 0;
              transform: translateY(20px);
          }
  
          #result.show {
              opacity: 1;
              transform: translateY(0);
          }
  
          #result h2 {
              color: var(--primary-color);
              margin-bottom: 1.2rem;
              font-size: 1.7rem;
              transition: color 0.3s ease;
          }
  
          #result p {
              margin-bottom: 0.8rem;
              font-size: 1.05rem;
              transition: color 0.3s ease;
          }
  
          #result strong {
              color: var(--text-color);
              font-weight: 500;
              transition: color 0.3s ease;
          }
  
          .error-message {
              color: var(--accent-color);
              background-color: #fff0f0;
              padding: 1.2rem;
              border-radius: 8px;
              text-align: center;
              font-weight: 500;
              font-size: 1.05rem;
              box-shadow: 0 2px 5px rgba(255, 107, 107, 0.2);
              transition: all 0.3s ease;
          }
  
          .loader {
              border: 4px solid #f3f3f3;
              border-top: 4px solid var(--primary-color);
              border-radius: 50%;
              width: 50px;
              height: 50px;
              animation: spin 1s linear infinite;
              margin: 1.5rem auto;
          }
  
          @keyframes spin {
              0% { transform: rotate(0deg); }
              100% { transform: rotate(360deg); }
          }
  
          footer {
              background-color: var(--header-bg);
              color: #ffffff;
              text-align: center;
              padding: 1.5rem;
              margin-top: auto;
              font-size: 0.9rem;
              transition: all 0.5s ease;
          }
  
          .captcha-container {
              display: flex;
              align-items: center;
              gap: 1rem;
              margin-bottom: 1rem;
          }
  
          #captchaImage {
              border: 1px solid #ddd;
              border-radius: 4px;
              transition: all 0.3s ease;
          }
  
          #refreshCaptcha {
              background-color: var(--primary-color);
              color: white;
              border: none;
              padding: 0.5rem 1rem;
              border-radius: 4px;
              cursor: pointer;
              font-size: 0.9rem;
              transition: all 0.3s ease;
          }
  
          #refreshCaptcha:hover {
              background-color: #3a7cbd;
              transform: translateY(-2px);
          }
  
          @media (max-width: 768px) {
              .container {
                  width: 95%;
                  padding: 2rem;
              }
  
              h1 {
                  font-size: 2rem;
              }
  
              .captcha-container {
                  flex-direction: column;
                  align-items: flex-start;
              }
          }
  
          .icon {
              margin-right: 0.5rem;
              color: var(--primary-color);
              transition: color 0.3s ease;
          }
  
          .signature-container {
              text-align: center;
              margin-top: 1rem;
          }
  
          .signature-image {
              max-width: 100%;
              height: auto;
              border: 1px solid #ddd;
              border-radius: 4px;
              box-shadow: 0 2px 5px rgba(0,0,0,0.1);
              transition: all 0.3s ease;
          }
  
          .signature-image:hover {
              transform: scale(1.05);
              box-shadow: 0 5px 15px rgba(0,0,0,0.2);
          }
  
          /* Animations */
          @keyframes pulse {
              0% { transform: scale(1); }
              50% { transform: scale(1.05); }
              100% { transform: scale(1); }
          }
  
          .pulse {
              animation: pulse 2s infinite;
          }
  
          .fade-in {
              opacity: 0;
              animation: fadeIn 0.5s ease forwards;
          }
  
          @keyframes fadeIn {
              to { opacity: 1; }
          }
  
          .slide-in {
              transform: translateX(-20px);
              opacity: 0;
              animation: slideIn 0.5s ease forwards;
          }
  
          @keyframes slideIn {
              to {
                  transform: translateX(0);
                  opacity: 1;
              }
          }
  
          .bounce {
              animation: bounce 0.5s;
          }
  
          @keyframes bounce {
              0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
              40% { transform: translateY(-20px); }
              60% { transform: translateY(-10px); }
          }
  
          /* New styles for survey button */
          .survey-button {
              background-color: var(--primary-color);
              color: white;
              padding: 1rem 2rem;
              border: none;
              border-radius: 8px;
              cursor: pointer;
              font-size: 1.2rem;
              font-weight: 500;
              transition: all 0.3s ease;
              box-shadow: 0 4px 6px rgba(0,0,0,0.1);
              margin-top: 2rem;
              display: block;
              width: 100%;
              text-align: center;
              text-decoration: none;
          }
  
          .survey-button:hover {
              background-color: #3a7cbd;
              transform: translateY(-3px);
              box-shadow: 0 6px 8px rgba(0,0,0,0.15);
          }
  
          .survey-button i {
              margin-right: 0.5rem;
          }
      </style>
  </head>
  <body>
      <header class="header">
          <div class="header-content">
              <h1><i class="fas fa-clipboard-list icon"></i>第八節意願調查查詢</h1>
          </div>
      </header>
  
      <div class="container">
          <h1 class="pulse"><i class="fas fa-search icon"></i>查詢您的填報紀錄</h1>
          
          <form id="queryForm">
              <label for="reportCode"><i class="fas fa-id-card icon"></i>學號：</label>
              <input type="text" id="reportCode" name="reportCode" required placeholder="請輸入您的學號">
              
              <label for="captchaInput"><i class="fas fa-shield-alt icon"></i>驗證碼：</label>
              <input type="text" id="captchaInput" name="captchaInput" required placeholder="請輸入驗證碼">
              <div class="captcha-container">
                  <img id="captchaImage" src="" alt="驗證碼" width="150" height="50">
                  <button type="button" id="refreshCaptcha"><i class="fas fa-sync-alt"></i> 刷新驗證碼</button>
              </div>
              <button type="submit" class="pulse"><i class="fas fa-search"></i> 查詢紀錄</button>
          </form>
  
          <div id="result"></div>
  
          <a href="https://samzhangw.github.io/sigin/" class="survey-button" target="_blank">
              <i class="fas fa-poll"></i> 填寫第八節意願調查
          </a>
      </div>
  
      <footer>
          <p>&copy; 2024 第八節意願調查填報查詢 All rights reserved.</p>
      </footer>
  
      <script>
          const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyaPZzxLyV9La_5V86LsEj0KYse4lyT5qBHbzxNHmLuMUm6Vom7OXgXSfPmwcfQQKC9bQ/exec';
          let captchaText = '';
  
          function generateCaptcha() {
              const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnpqrstuvwxyz23456789';
              captchaText = '';
              for (let i = 0; i < 6; i++) {
                  captchaText += chars.charAt(Math.floor(Math.random() * chars.length));
              }
              return captchaText;
          }
  
          function drawCaptcha() {
              const canvas = document.createElement('canvas');
              const ctx = canvas.getContext('2d');
              canvas.width = 150;
              canvas.height = 50;
  
              // Background
              ctx.fillStyle = '#f7f9fc';
              ctx.fillRect(0, 0, canvas.width, canvas.height);
  
              // Text
              ctx.font = 'bold 30px Arial';
              ctx.fillStyle = '#333333';
              ctx.textBaseline = 'middle';
              ctx.textAlign = 'center';
              
              for (let i = 0; i < captchaText.length; i++) {
                  const x = (i + 1) * (canvas.width / (captchaText.length + 1));
                  const y = canvas.height / 2 + Math.random() * 10 - 5;
                  ctx.save();
                  ctx.translate(x, y);
                  ctx.rotate((Math.random() - 0.5) * 0.4);
                  ctx.fillText(captchaText[i], 0, 0);
                  ctx.restore();
              }
  
              // Noise lines
              for (let i = 0; i < 3; i++) {
                  ctx.beginPath();
                  ctx.moveTo(Math.random() * canvas.width, Math.random() * canvas.height);
                  ctx.lineTo(Math.random() * canvas.width, Math.random() * canvas.height);
                  ctx.strokeStyle = `rgba(${Math.random() * 255},${Math.random() * 255},${Math.random() * 255},0.5)`;
                  ctx.stroke();
              }
  
              // Set image source
              document.getElementById('captchaImage').src = canvas.toDataURL();
          }
  
          function refreshCaptcha() {
              generateCaptcha();
              drawCaptcha();
              document.getElementById('captchaImage').classList.add('bounce');
              setTimeout(() => {
                  document.getElementById('captchaImage').classList.remove('bounce');
              }, 500);
          }
  
          document.addEventListener('DOMContentLoaded', function() {
              refreshCaptcha();
              document.getElementById('refreshCaptcha').addEventListener('click', refreshCaptcha);
          });
  
          document.getElementById('queryForm').addEventListener('submit', function(e) {
              e.preventDefault();
              const reportCode = document.getElementById('reportCode').value;
              const captchaInput = document.getElementById('captchaInput').value;
              
              if (captchaInput.toLowerCase() !== captchaText.toLowerCase()) {
                  alert('驗證碼錯誤，請重新輸入');
                  refreshCaptcha();
                  document.getElementById('captchaInput').value = '';
                  return;
              }
              
              queryReport(reportCode);
          });
  
          function queryReport(reportCode) {
              const resultDiv = document.getElementById('result');
              resultDiv.classList.remove('show');
              resultDiv.innerHTML = '<div class="loader"></div>';
              resultDiv.classList.add('show');
  
              fetch(`${SCRIPT_URL}?action=query&reportCode=${reportCode}`)
              .then(response => response.json())
                  .then(data => {
                      resultDiv.classList.remove('show');
                      setTimeout(() => {
                          if (data.found) {
                              resultDiv.innerHTML = `
                                  <h2 class="fade-in"><i class="fas fa-clipboard-check icon"></i>查詢結果</h2>
                                  <p class="slide-in"><strong><i class="far fa-clock icon"></i>時間戳記：</strong> ${data.timestamp}</p>
                                  <p class="slide-in"><strong><i class="fas fa-id-card icon"></i>學號：</strong> ${data.reportCode}</p>
                                  <p class="slide-in"><strong><i class="fas fa-user icon"></i>姓名：</strong> ${data.name}</p>
                                  <p class="slide-in"><strong><i class="fas fa-chalkboard-teacher icon"></i>班級：</strong> ${data.class}</p>
                                  <p class="slide-in"><strong><i class="fas fa-calendar-check icon"></i>是否參加第八節：</strong> ${data.intention}</p>
                                  ${data.intention === '不參加' ? `<p class="slide-in"><strong><i class="fas fa-comment-alt icon"></i>不參加原因：</strong>${data.reason}</p>` : ''}
                                  <div class="signature-container fade-in">
                                      <p><strong><i class="fas fa-signature icon"></i>家長簽名：</strong></p>
                                      <img src="${data.signature}" alt="家長簽名" class="signature-image">
                                  </div>
                              `;
                          } else {
                              resultDiv.innerHTML = '<p class="error-message fade-in"><i class="fas fa-exclamation-triangle icon"></i>找不到相關回報紀錄。請確認學號是否正確。</p>';
                          }
                          resultDiv.classList.add('show');
                          refreshCaptcha();
                          document.getElementById('captchaInput').value = '';
                      }, 300);
                  })
                  .catch(error => {
                      console.error('Error:', error);
                      resultDiv.classList.remove('show');
                      setTimeout(() => {
                          resultDiv.innerHTML = '<p class="error-message fade-in"><i class="fas fa-exclamation-circle icon"></i>查詢時發生錯誤。請稍後再試。</p>';
                          resultDiv.classList.add('show');
                          refreshCaptcha();
                          document.getElementById('captchaInput').value = '';
                      }, 300);
                  });
          }
  
          // Prevent copying
          document.addEventListener('copy', function(e) {
              e.preventDefault();
              return false;
          });
  
          // Prevent screenshot (only works in some browsers)
          document.addEventListener('keyup', function(e) {
              if (e.key == 'PrintScreen') {
                  navigator.clipboard.writeText('');
                  alert('截圖功能已被禁用');
              }
          });
  
          // Prevent right-click
          document.addEventListener('contextmenu', function(e) {
              e.preventDefault();
          });
  
          // Prevent text selection
          document.onselectstart = function() {
              return false;
          };
      </script>
  </body>
  </html>
  </body></html>
